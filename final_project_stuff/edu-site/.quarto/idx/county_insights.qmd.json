{"title":"Beyond the Report Card: What are the insights at the county level that we can observe?","markdown":{"yaml":{"title":"Beyond the Report Card: What are the insights at the county level that we can observe?","author":"Thu Dang, Nathaniel Reimer, Jeremy Hubinger","execute":{"echo":false,"warning":false,"message":false}},"headingText":"Map of County-level academic achievement categories in California","containsRefs":false,"markdown":"\n\n```{r packages}\nlibrary(tidyverse)\nlibrary(MetBrewer)\nlibrary(sf)\nlibrary(rnaturalearth)\nlibrary(classInt) #install.packages('classInt')\nlibrary(ggspatial) #install.packages('ggspatial')\nlibrary(ggthemes) #install.packages('ggthemes')\nlibrary(RColorBrewer)\nlibrary(patchwork)\nlibrary(leaflet)\nlibrary(probably) #install.packages('probably')\nlibrary(glmnet)\nlibrary(tidymodels)\ntidymodels_prefer()\n```\n\n```{r color}\npalname = \"Homer2\"\ndefaultcolor = met.brewer(palname,10)[9]\n```\n\n```{r load datasets}\nload(\"../CombinedDataLongFormat.RData\")\nload(\"../WideMergedData.RData\")\n```\n\n```{r load cleaned dataset for county achievement metrics}\nmath_ca_gcs_df <- read_csv(\"../AllDatasets/math_ca_gcs_df.csv\")\nrla_ca_gcs_df <- read_csv(\"../AllDatasets/rla_ca_gcs_df.csv\")\n```\n\n```{r maps load shapefile}\nca_counties <- read_sf('../CA_Counties')\nca_counties <- ca_counties %>%\n  st_transform(crs = \"NAD83\")\n```\n\n\n```{r gcs map data cleaning}\nschool_map <- merged_table %>%\n  select(CDSCode, School, gradecenter, gcs_mn_avg_ol, Longitude, Latitude) %>%\n  filter(!is.na(gradecenter) & !is.na(gcs_mn_avg_ol)) %>% #7390 after NA gradecenter, 6997 after both conditions\n  distinct %>%\n  mutate(diff_from_gradecenter = gcs_mn_avg_ol - gradecenter) %>%\n  mutate(gcs_type = ifelse(diff_from_gradecenter < 0, \"Below NAEP Average\", ifelse(diff_from_gradecenter > 0, \"Above NAEP Average\", \"At NAEP Average\")))\n\nschool_map_sf <- school_map %>% \n  st_as_sf(coords = c('Longitude', 'Latitude'), crs = \"NAD83\")\n\nschool_county_sf <- st_join(school_map_sf, ca_counties) \n\ngrade_diff_by_county <- school_county_sf %>%\n  st_drop_geometry() %>% #removes geometry - makes calculation more efficient \n  group_by(NAMELSAD) %>%\n  summarise(mean_gcs_diff = mean(diff_from_gradecenter))\n\ngrade_diff_by_county_geo <- ca_counties %>%\n  left_join(grade_diff_by_county, by=\"NAMELSAD\")\n```\n\n```{r gcs map}\ngrade_diff_by_county_with_breaks_geo <- grade_diff_by_county_geo %>%\n  mutate(grade_diff_cat = factor(cut(mean_gcs_diff, breaks=c(-2, -1, 0, 1, 2))))\n\npal <- colorFactor(\n  palette = met.brewer(palname,3)[1:3],\n  domain = grade_diff_by_county_with_breaks_geo$grade_diff_cat\n)\n\nleaflet(grade_diff_by_county_with_breaks_geo) %>%\n  addPolygons(\n    fillColor = ~pal(grade_diff_cat),\n    opacity = .25,\n    color = \"white\",\n    fillOpacity = .5,\n    group = \"County\",\n    popup = ~paste0(NAMELSAD, \n                    \"<br>Grade Distance from National Average: \", round(mean_gcs_diff, digits = 3))\n  )  %>% \n  addProviderTiles(providers$CartoDB.Positron) %>%\n    addLayersControl(\n    baseGroups = \"County\",\n    position = \"topright\"\n\n  ) %>%\n  addLegend(colors = met.brewer(palname,3)[1:3], values = ~grade_diff_cat, title = NULL, labels = c('1-2 years behind', 'Less than 1 year behind', 'Less than 1 year ahead'), className = \"info legend County\")\n\n```\n\n## Aggregated county-level math and reasoning language arts (RLA) achievement of students of different socioeconomic status groups\n\n```{r math data cleaning for ecd and nec leaflet}\nsummary_math_data <- ca_counties %>%\n  left_join(math_ca_gcs_df, by=c(\"NAMELSAD\" = \"sedacountyname\")) %>%\n  filter(student_category %in% c('ecd','nec')) %>%\n  filter(!is.na(gcs_value) & !is.na(student_category)) %>%\n  select(NAMELSAD, grade, year, gcs_value, student_category, clean_student_category) %>%\n  mutate(gcs_diff = gcs_value - grade) %>%\n  st_drop_geometry() %>%\n  group_by(NAMELSAD, student_category, clean_student_category) %>%\n  summarise(mean_gcs_diff = mean(gcs_diff)) %>%\n  ungroup()\n\nsummary_math_data_with_geo <- ca_counties %>%\n  select(NAMELSAD) %>%\n  left_join(summary_math_data, by=\"NAMELSAD\")\n\nsummary_math_data_with_geo <- summary_math_data_with_geo %>%\n  mutate(mean_gcs_diff_cat = factor(cut(mean_gcs_diff, breaks=c(-3, -2, -1, 0, 1, 2, 3))))\n```\n\n```{r rla data cleaning for ecd and nec leaflet}\nsummary_rla_data <- ca_counties %>%\n  left_join(rla_ca_gcs_df, by=c(\"NAMELSAD\" = \"sedacountyname\")) %>%\n  filter(student_category %in% c('ecd','nec')) %>%\n  filter(!is.na(gcs_value) & !is.na(student_category)) %>%\n  select(NAMELSAD, grade, year, gcs_value, student_category, clean_student_category) %>%\n  mutate(gcs_diff = gcs_value - grade) %>%\n  st_drop_geometry() %>%\n  group_by(NAMELSAD, student_category, clean_student_category) %>%\n  summarise(mean_gcs_diff = mean(gcs_diff)) %>%\n  ungroup()\n\nsummary_rla_data_with_geo <- ca_counties %>%\n  select(NAMELSAD) %>%\n  left_join(summary_rla_data, by=\"NAMELSAD\")\n\nsummary_rla_data_with_geo <- summary_rla_data_with_geo %>%\n  mutate(mean_gcs_diff_cat = factor(cut(mean_gcs_diff, breaks=c(-3, -2, -1, 0, 1, 2, 3))))\n```\n\n\n```{r math ecd performance map}\npal <- colorFactor(\n  palette = met.brewer(palname,6)[1:6],\n  domain = summary_math_data$mean_gcs_diff_cat\n)\n\nleaflet() %>%\n  addProviderTiles(providers$CartoDB.Positron) %>%\n    addLayersControl(\n    baseGroups = \"County\",\n    position = \"topright\"\n  ) %>%\n  addPolygons(\n    data = summary_math_data_with_geo %>% filter(student_category == 'ecd'),\n    fillColor = ~pal(mean_gcs_diff_cat),\n    opacity = .25,\n    color = \"white\",\n    fillOpacity = .5,\n    group = \"Math: Economically Disadvantaged\",\n    popup = ~paste0(NAMELSAD, \n                    \"<br>Grade Distance from National Average: \", round(mean_gcs_diff, digits = 3)\n    )\n  )  %>% \n  addPolygons(\n    data = summary_math_data_with_geo %>% filter(student_category == 'nec'),\n    fillColor = ~pal(mean_gcs_diff_cat),\n    opacity = .25,\n    color = \"white\",\n    fillOpacity = .5,\n    group = \"Math: Non-Economically Disadvantaged\",\n    popup = ~paste0(NAMELSAD, \n                    \"<br>Grade Distance from National Average: \", round(mean_gcs_diff, digits = 3)\n    )\n  )  %>% \n  addPolygons(\n    data = summary_rla_data_with_geo %>% filter(student_category == 'ecd'),\n    fillColor = ~pal(mean_gcs_diff_cat),\n    opacity = .25,\n    color = \"white\",\n    fillOpacity = .5,\n    group = \"RLA: Economically Disadvantaged\",\n    popup = ~paste0(NAMELSAD, \n                    \"<br>Grade Distance from National Average: \", round(mean_gcs_diff, digits = 3)\n    )\n  )  %>% \n  addPolygons(\n    data = summary_rla_data_with_geo %>% filter(student_category == 'nec'),\n    fillColor = ~pal(mean_gcs_diff_cat),\n    opacity = .25,\n    color = \"white\",\n    fillOpacity = .5,\n    group = \"RLA: Non-Economically Disadvantaged\",\n    popup = ~paste0(NAMELSAD, \n                    \"<br>Grade Distance from National Average: \", round(mean_gcs_diff, digits = 3)\n    )\n  )  %>% \n  addLayersControl(baseGroups = c(\"Math: Economically Disadvantaged\", \"Math: Non-Economically Disadvantaged\", \"RLA: Economically Disadvantaged\", \"RLA: Non-Economically Disadvantaged\"),\n                   position = \"bottomleft\", options = layersControlOptions(collapsed = FALSE)) %>% \n  addLegend(colors = met.brewer(palname,6)[1:6], values = ~mean_gcs_diff_cat, title = NULL, labels = c('2+ years behind','1-2 years behind', 'Less than 1 year behind', 'Less than 1 year ahead', '1-2 years ahead', '2+ years ahead'), group = \"Economically Disadvantaged\")\n```\n\n\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"county_insights.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.269","editor":"visual","theme":"zephyr","title":"Beyond the Report Card: What are the insights at the county level that we can observe?","author":"Thu Dang, Nathaniel Reimer, Jeremy Hubinger"},"extensions":{"book":{"multiFile":true}}}}}