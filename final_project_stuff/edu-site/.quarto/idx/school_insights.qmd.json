{"title":"Beyond the Report Card: What are the insights at the school level that we can observe?","markdown":{"yaml":{"title":"Beyond the Report Card: What are the insights at the school level that we can observe?","author":"Thu Dang, Nathaniel Reimer, Jeremy Hubinger","execute":{"echo":false,"warning":false,"message":false}},"headingText":"Map of School-level academic achievement categories across California counties","containsRefs":false,"markdown":"\n\n```{r packages}\nlibrary(tidyverse)\nlibrary(MetBrewer)\nlibrary(sf)\nlibrary(rnaturalearth)\nlibrary(classInt) #install.packages('classInt')\nlibrary(ggspatial) #install.packages('ggspatial')\nlibrary(ggthemes) #install.packages('ggthemes')\nlibrary(RColorBrewer)\nlibrary(patchwork)\nlibrary(leaflet)\nlibrary(probably) #install.packages('probably')\nlibrary(glmnet)\nlibrary(tidymodels)\ntidymodels_prefer()\n```\n\n```{r color}\npalname = \"Homer2\"\ndefaultcolor = met.brewer(palname,10)[9]\n```\n\n```{r load datasets}\nload(\"../CombinedDataLongFormat.RData\")\nload(\"../WideMergedData.RData\")\n```\n\n```{r load cleaned dataset for county achievement metrics}\nmath_ca_gcs_df <- read_csv(\"../AllDatasets/math_ca_gcs_df.csv\")\nrla_ca_gcs_df <- read_csv(\"../AllDatasets/rla_ca_gcs_df.csv\")\n```\n\n```{r maps load shapefile}\nca_counties <- read_sf('../CA_Counties')\nca_counties <- ca_counties %>%\n  st_transform(crs = \"NAD83\")\n```\n\n\n```{r funding/performance map}\nmapdata <- wide_merged_data %>% filter(!is.na(gradecenter)&!is.na(gcs_mn_avg_ol)) %>% \n  mutate(diff_from_gradecenter = gcs_mn_avg_ol - gradecenter, pp_total_raw = as.numeric(pp_total_raw)) %>%\n  mutate(Longitude = as.numeric(Longitude), Latitude = as.numeric(Latitude)) %>%\n  mutate(pp_total_raw_cat = cut(pp_total_raw, breaks = c(0,10000,15000,20000,Inf))) %>%\n  mutate(diff_from_gradecenter_cat = cut(diff_from_gradecenter, breaks = c(-Inf, -3, -1, 1, 3, Inf)))\n\np1 <- colorFactor(\n  palette = met.brewer(palname, 5)[1:5],\n  domain = mapdata$diff_from_gradecenter_cat\n)\n\npal <- colorFactor(\n  palette = met.brewer(palname, 4)[1:4],\n  domain = mapdata$pp_total_raw_cat\n)\n\nleaflet(mapdata) %>% addProviderTiles(providers$CartoDB.Positron) %>% \n  addCircleMarkers(\n    color = ~p1(diff_from_gradecenter_cat),\n    radius = ~(as.numeric(ncesenroll)/400),\n    popup = ~paste0(School, \n                    \"<br>Grade Distance from National Average: \", round(diff_from_gradecenter, digits = 3),\n                    \"<br>Per Pupil Funding: \", pp_total_raw,\n                    \"<br>Enrollment: \", ncesenroll\n    ),\n    group = \"Performance\"\n  ) %>% \n  addLegend(position = \"bottomright\", colors = met.brewer(palname, 5)[1:5], title = \"Performance\", labels = c(\"3+ years behind\", \"1-3 years behind\",  \"Within 1 year of national average\",  \"1-3 years ahead\", \"3+ years ahead\"))\n\n\n\nleaflet(mapdata) %>% addProviderTiles(providers$CartoDB.Positron) %>% \n  addCircleMarkers(\n    color = ~pal(pp_total_raw_cat),\n    radius = ~(as.numeric(ncesenroll)/400),\n    popup = ~paste0(School, \n                    \"<br>Grade Distance from National Average: \", round(diff_from_gradecenter, digits = 3),\n                    \"<br>Per Pupil Funding: \", pp_total_raw,\n                    \"<br>Enrollment: \", ncesenroll\n    ),\n    stroke = ~ifelse(!is.na(pp_total_raw_cat), TRUE, FALSE),\n    group = \"Funding\"\n  ) %>%\naddLegend(\"bottomright\", colors = met.brewer(palname, 4)[1:4], title = \"Per Student Funding\", labels = c(\"$10,000 or less\", \"$10,000 to $15,000\", \"15,000 to 20,000\", \"Greater than 20,000\")) \n```\n\n## Does funding impact school-level academic achievement?\n\n```{r funding and performance by area}\nwide_merged_data %>% filter(!is.na(urbanicity)) %>%\n  ggplot(aes(x=as.numeric(pp_total_raw), y=(as.numeric(gcs_mn_avg_ol)-as.numeric(gradecenter)))) +\n  geom_point(alpha = .1, color=defaultcolor) + \n  geom_smooth(method = lm, color=defaultcolor) + \n  facet_wrap(~urbanicity) + \n  scale_x_continuous(limits = c(8000,18000)) + \n  theme_minimal()+\n  labs(y=\"Grade Cohort Score\", x= \"Unadjusted Per Student Spending\") + guides(color=\"none\") +   geom_hline(yintercept = 0)\n```\n\n```{r funding model, results='hide'}\n#| message: true\nfundingmod<-wide_merged_data %>% \n  filter(!is.na(pp_total_raw)&!is.na(perfrl)) %>% \n  lm(formula = as.numeric(pp_total_raw) ~ as.numeric(perfrl) + \n       as.numeric(lep_flag) + \n       as.numeric(perfrl)*as.numeric(lep_flag)) %>%\n  summary()\n\nlunchfundingmod<-wide_merged_data %>% \n  filter(!is.na(pp_total_raw)&!is.na(perfrl)) %>% \n  lm(formula = as.numeric(pp_total_raw) ~ as.numeric(perfrl)) %>%\n  summary()\n\n# fundingmod$coefficients\nlunchfundingmod$coefficients\n```\n\n\n```{r area adjusted graph}\nwide_merged_data %>% filter(!is.na(urbanicity)) %>% mutate(pp_total_raw_frl_adjusted = as.numeric(pp_total_raw) - as.numeric(perfrl)*lunchfundingmod$coefficients[2],\n  pp_total_raw = as.numeric(pp_total_raw)) %>%\n  ggplot(aes(x=as.numeric(pp_total_raw_frl_adjusted), y=(as.numeric(gcs_mn_avg_ol)-as.numeric(gradecenter)))) +\n  geom_point(alpha = .1, color=defaultcolor) + \n  geom_smooth(method = lm, color=defaultcolor) + \n  facet_wrap(~urbanicity) + \n  scale_x_continuous(limits = c(8000,18000)) + \n  theme_minimal()+\n  labs(y=\"Grade Cohort Score\", x= \"Adjusted Per Student Spending\") + guides(color=\"none\") +   geom_hline(yintercept = 0)\n```\n\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"school_insights.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.269","editor":"visual","theme":"zephyr","title":"Beyond the Report Card: What are the insights at the school level that we can observe?","author":"Thu Dang, Nathaniel Reimer, Jeremy Hubinger"},"extensions":{"book":{"multiFile":true}}}}}